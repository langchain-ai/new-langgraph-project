PyMuPDFçš„ä¸»è¦èŒè´£
PyMuPDFåœ¨è¿™ä¸ªåŒ»ç–—æ–‡æ¡£å¤„ç†ç³»ç»Ÿä¸­æ‰®æ¼”ç€PDFé¢„å¤„ç†å™¨çš„å…³é”®è§’è‰²ï¼Œå®ƒä¸è´Ÿè´£OCRï¼Œè€Œæ˜¯ä¸ºAWS Textractå‡†å¤‡å’Œä¼˜åŒ–PDFæ–‡æ¡£ã€‚

ğŸ¯ å…·ä½“åŠŸèƒ½è¯¦è§£
1. PDFæ–‡æ¡£æµå¼è¯»å–
# ä»S3ç›´æ¥è¯»å–PDFåˆ°å†…å­˜ï¼Œæ— éœ€ä¸‹è½½åˆ°æœ¬åœ°
pdf_content = self.document.s3_storage_uri.open().read()
doc = fitz.open(stream=pdf_content, filetype="pdf")
2. å¤šé¡µPDFæ™ºèƒ½åˆ†å‰²
def _split_pdf_pages(doc: DocumentModel) -> list[str]:
    """å°†å¤šé¡µPDFåˆ†å‰²ä¸ºå•é¡µï¼Œä¸ºTextractä¼˜åŒ–"""
    # æ‰“å¼€PDFå¹¶æ£€æŸ¥é¡µæ•°
    pdf_document = fitz.open(stream=pdf_content, filetype="pdf")
    page_count = len(pdf_document)
    
    # é¡µæ•°é™åˆ¶æ£€æŸ¥
    if page_count > MAX_PDF_PAGES:  # MAX_PDF_PAGES = 5
        return [s3_key]  # è¶…è¿‡é™åˆ¶ï¼Œè¿”å›åŸæ–‡ä»¶
    
    # åˆ†å‰²æ¯ä¸€é¡µ
    for page_num in range(page_count):
        # åˆ›å»ºæ–°çš„å•é¡µPDF
        single_page_pdf = fitz.open()
        single_page_pdf.insert_pdf(
            pdf_document,
            from_page=page_num,
            to_page=page_num,
        )
        
        # è½¬æ¢ä¸ºå­—èŠ‚æµ
        page_bytes = single_page_pdf.tobytes()
        
ä¸ºä»€ä¹ˆéœ€è¦åˆ†å‰²ï¼Ÿ
Textracté™åˆ¶: AWS Textractå¯¹å¤šé¡µPDFå¤„ç†æœ‰é™åˆ¶
å¹¶è¡Œå¤„ç†: å•é¡µå¯ä»¥å¹¶è¡Œå‘é€ç»™Textract
é”™è¯¯éš”ç¦»: å•é¡µå¤±è´¥ä¸å½±å“å…¶ä»–é¡µé¢
å†…å­˜ä¼˜åŒ–: é¿å…å¤§æ–‡ä»¶ä¸€æ¬¡æ€§å¤„ç†

3. é¡µé¢å›¾åƒè½¬æ¢
def _process_single_page(self, page, page_num: int, s3_uri: str) -> ProcessedPage:
    """å°†PDFé¡µé¢è½¬æ¢ä¸ºé«˜è´¨é‡å›¾åƒ"""
    # æå–æ–‡æœ¬ï¼ˆå¦‚æœPDFæœ‰æ–‡æœ¬å±‚ï¼‰
    text = page.get_text()
    # è½¬æ¢ä¸ºé«˜è´¨é‡å›¾åƒ
    pix = page.get_pixmap(matrix=fitz.Matrix(2, 2))  # 2xç¼©æ”¾æé«˜è´¨é‡
    image_bytes = pix.tobytes("jpeg")
    
    # å‘é€ç»™AWS Rekognitionè¿›è¡Œå›¾åƒåˆ†æ
    rekognition_response = self._analyze_image(image_bytes, page_num)

å›¾åƒè½¬æ¢çš„ç”¨é€”ï¼š
Rekognitionåˆ†æ: è¯†åˆ«åŒ»ç–—å›¾åƒã€ä¼¤å£ç…§ç‰‡ã€äº§å“å›¾ç‰‡
è´¨é‡ä¼˜åŒ–: 2xç¼©æ”¾æé«˜OCRå’Œå›¾åƒè¯†åˆ«ç²¾åº¦
æ ¼å¼æ ‡å‡†åŒ–: ç»Ÿä¸€è½¬æ¢ä¸ºJPEGæ ¼å¼

ğŸš« PyMuPDFä¸è´Ÿè´£çš„åŠŸèƒ½
1. ä¸åšOCR
# PyMuPDFåªæå–ç°æœ‰æ–‡æœ¬ï¼Œä¸è¿›è¡ŒOCR
text = page.get_text()  # åªèƒ½æå–PDFä¸­å·²æœ‰çš„æ–‡æœ¬å±‚

# OCRç”±AWS Textractè´Ÿè´£
textract_response = textract.analyze_document(...)
2. ä¸åšAIåˆ†æ
# PyMuPDFåªè½¬æ¢å›¾åƒï¼Œä¸åˆ†æå†…å®¹
image_bytes = pix.tobytes("jpeg")

3. ä¸åšæ•°æ®æå–
# PyMuPDFä¸ç†è§£åŒ»ç–—è¡¨å•ç»“æ„
# æ•°æ®æå–ç”±Claude AI + Textractç»“æœå®Œæˆ
structured_result = claude_model.invoke(textract_data)